<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>DomTerm</title>
<link rel="stylesheet" href="qrc:style/domterm-core.css">
<link rel="stylesheet" href="qrc:style/domterm-standard.css">
<link rel="stylesheet" href="qrc:style/domterm-default.css">
<script type="text/javascript" src="qrc:ResizeSensor.js"> </script>
<script type="text/javascript" src="qrc:bililiteRange.js"> </script>
<script type="text/javascript" src="qrc:terminal.js"> </script>
<script type="text/javascript" src="qrc:qwebchannel.js"> </script>
<script type="text/javascript">
function loadHandler(event) {
    var wt = new DomTerm("term1");
    window.domterm1 = wt;
    var topNode = document.getElementById("term1");

    var query = location.search;
    var ws = query.match(/ws=([^&]*)/);
    if (ws) {
        var wsocket = new WebSocket(ws[1]);
        wt.processInputCharacters = function(str) { wsocket.send(str); };
        wsocket.onmessage = function(evt) {  wt.insertString(evt.data); }
        var topNode = document.getElementById("term1");
        wsocket.onopen = function(e) {
            wsocket.send("\x92VERSION QtDomTerm;"+wt.versionInfo+"\n");
            wt.initializeTerminal(topNode); };
        return;
    }
    new QWebChannel(qt.webChannelTransport,
        function(channel) {
            var backend = channel.objects.backend;
            window.backend = backend;
            backend.reportEvent("VERSION", wt.versionInfo);
            wt.initializeTerminal(topNode);
            wt.processInputCharacters =
                function(str) { if (backend) backend.processInputCharacters(str); };
            wt.reportEvent =
                function(name, data) { if (backend) backend.reportEvent(name, data); };
	    wt.setWindowSize =
                function(numRows, numColumns, availHeight, availWidth) {
                    if (backend)
                        backend.setWindowSize(numRows, numColumns,
                                              availHeight, availWidth);
            };
            wt.log =
                function(str) {
                    if (backend) backend.log(str); };
            wt.close = function() { if (backend) backend.close(); }
            backend.write.connect(function (msg) {
                wt.insertString(msg); });
            backend.run();
    });
}
window.addEventListener("load", loadHandler, false);
</script>
</head>
<body><div class="domterm" id="term1"></div></body>
</html>
